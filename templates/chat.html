<!DOCTYPE html>
<html lang="es">
<head>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <title>Chat with EverydAI</title>
</head>

<body>
    <div id="recommendations-box" class="recommendations-box">
        <h3>Recommendations:</h3>
        <ul id="recommendations-list"></ul>
    </div>
    <div class="chat-container">
        <h1>Chat with EverydAI</h1>

        <!-- Selector de modelo -->
        <label for="model-select">Escoge un modelo:</label>
        <select id="model-select">
            <option value="culinary">Culinario</option>
            <option value="fashion">Moda</option>
            <option value="Gym">Gym</option>
        </select>

        <div id="chat-box"></div>
        <input type="text" id="user-input" placeholder="Chat with us...">
        <button id="send-button">Send</button>
        <button id="record-button">Talk</button>
        <input type="file" id="image-input" accept="image/*">
        <button id="upload-button">Upload Image</button>
        <button id="camera-button">Open Camera</button>
        <button id="capture-button" style="display:none;">Capture</button>

        <video id="video-preview" autoplay style="display:none; width: 300px;"></video>
        <canvas id="canvas" style="display:none;"></canvas>

        <div id="image-preview-container" style="text-align: center;">
            <img id="image-preview" alt="Your uploaded image will appear here" style="display: none; width: 300px; margin-top: 10px;">
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const modelSelect = document.getElementById("model-select");  // Selector del modelo
            const imageInput = document.getElementById("image-input");
            const imagePreview = document.getElementById("image-preview");

            // Evento al hacer clic en el botón de enviar texto
            document.getElementById("send-button").onclick = function() {
                const userInput = document.getElementById("user-input").value;
                const selectedModel = modelSelect.value;  // Obtener modelo seleccionado

        if (userInput.trim() !== "") {
            document.getElementById("chat-box").innerHTML += `<div>Usuario: ${userInput}</div>`;
            document.getElementById("user-input").value = '';

                    // Envía el mensaje y el modelo seleccionado al servidor
                    fetch('/chat', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ message: userInput, model: selectedModel }),
                    })
                    .then(response => response.json())
                    .then(data => {
                        document.getElementById("chat-box").innerHTML += `<div>Modelo: ${data.response}</div>`;
                    })
                    .catch(error => console.error('Error:', error));
                } else {
                    alert("Por favor, ingresa un mensaje.");
                }
            };

            // Evento al hacer clic en el botón de cargar imagen
            document.getElementById("upload-button").onclick = function() {
                const file = imageInput.files[0];

                if (file) {
                    const formData = new FormData();
                    formData.append('image', file);

                    // Envía la imagen al servidor
                    fetch('/upload-image', {
                        method: 'POST',
                        body: formData,
                    })
                    .then(response => response.json())
                    .then(data => {
                        document.getElementById("chat-box").innerHTML += `<div>Modelo: ${data.response}</div>`;
                    })
                    .catch(error => console.error('Error:', error));
                } else {
                    alert("Por favor, selecciona una imagen.");
                }
            };
        });
    </script>
       <div id="recetas-box">
        <h3>Recetas recomendadas:</h3>
        <ul id="recetas-list"></ul>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const modelSelect = document.getElementById("model-select");  // Selector del modelo

        document.getElementById("send-button").onclick = function() {
            const userInput = document.getElementById("user-input").value;
            const selectedModel = modelSelect.value;  // Obtener modelo seleccionado

            if (userInput.trim() !== "") {
                document.getElementById("chat-box").innerHTML += `<div>Usuario: ${userInput}</div>`;
                document.getElementById("user-input").value = '';

                // Envía el mensaje y el modelo seleccionado al servidor
                fetch('/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ message: userInput, model: selectedModel }),
                })
                .then(response => response.json())
                .then(data => {
                    // Mostrar la respuesta del modelo
                    document.getElementById("chat-box").innerHTML += `<div>Modelo: ${data.response}</div>`;

                    // Mostrar recetas en el frontend
                    const recetasList = document.getElementById("recetas-list");
                    recetasList.innerHTML = '';  // Limpia las recetas previas
                    if (data.recetas && data.recetas.length > 0) {
                        data.recetas.forEach(receta => {
                            const listItem = document.createElement("li");
                            listItem.innerHTML = `<a href="${receta.link}" target="_blank">${receta.title}</a>`;
                            recetasList.appendChild(listItem);
                        });
                    } else {
                        recetasList.innerHTML = '<li>No se encontraron recetas.</li>';
                    }
                })
                .catch(error => console.error('Error:', error));
            } else {
                alert("Por favor, ingresa un mensaje.");
            }
        };
    });
</script>
</body>
</html>